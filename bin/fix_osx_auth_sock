#!/bin/bash
#
# Finds the socket used by the OSX keychain agent (aka ssh-agent) and sets the
# appropriate env var
#
# When a tmux session is started, the proper env vars are copied from the main
# shell to any shells opened within tmux, so SSH "just works".  However, when
# another host attaches to that tmux session, the ssh-agent connection in the
# original-attachement gets broken (think attaching to a tmux session started
# at work from a machine at home).
#
# "The SSH_AUTH_SOCK variable identifies the path of a unix-domain socket used
# "to communicate with the agent. In other words, this variable sets up a
# "path" back to the host that is actually running the agent, so that future
# ssh connections can talk to/use that agent.
_OSX_KEYCHAIN_AGENT_SOCKETS=`find /tmp/ -type s -regex '.*/launch-.*/Listeners$'  2> /dev/null`
printf "Found ssh-agent at: %s\n" $_OSX_KEYCHAIN_AGENT_SOCKETS
export SSH_AUTH_SOCK=${_OSX_KEYCHAIN_AGENT_SOCKETS}
